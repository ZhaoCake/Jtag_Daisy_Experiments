# OpenOCD configuration for dual-JTAG daisy chain simulation

adapter driver remote_bitbang
remote_bitbang host localhost
remote_bitbang port 9823

# Define the TAPs
# Note: OpenOCD scans data from TDO to TDI. 
# The device closest to TDO shifts out its IDCODE first.

# TAP 2 (Closest to TDO)
# IDCODE observed: 0x2e200a6d
# IrLength: 5 (from dmi_jtag_tap.sv)
jtag newtap tap2 tap -irlen 5 -expected-id 0x2e200a6d

# TAP 1 (Closest to TDI)
# IDCODE observed: 0x1e200a6d
# IrLength: 5 (from dmi_jtag_tap.sv)
jtag newtap tap1 tap -irlen 5 -expected-id 0x1e200a6d

# Define the targets
# Each TAP corresponds to a Debug Transport Module (DTM) for a RISC-V core (or cluster).

# Target for TAP 2
target create core2 riscv -chain-position tap2.tap -coreid 0

# Target for TAP 1
target create core1 riscv -chain-position tap1.tap -coreid 0

# Initialize
init

# Increase timeout for simulation (slower than real hardware)
riscv set_command_timeout_sec 60

# Scan the chain to verify
scan_chain

# Display information about the targets
echo "Target status:"
targets
